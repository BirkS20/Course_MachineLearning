<!--
Automatically generated HTML file from DocOnce source
(https://github.com/doconce/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Week 43: Deep Learning: Recurrent Neural Networks and other methods">

<title>Week 43: Deep Learning: Recurrent Neural Networks and other methods</title>

<!-- Bootstrap style: bootstrap -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>


</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('Plans for week 43', 2, None, 'plans-for-week-43'),
              ('Reading Recommendations', 2, None, 'reading-recommendations'),
              ('Summary on Deep Learning Methods',
               2,
               None,
               'summary-on-deep-learning-methods'),
              ('CNNs in brief', 2, None, 'cnns-in-brief'),
              ('Recurrent neural networks: Overarching view',
               2,
               None,
               'recurrent-neural-networks-overarching-view'),
              ('Set up of an RNN', 2, None, 'set-up-of-an-rnn'),
              ('A simple example', 2, None, 'a-simple-example'),
              ('An extrapolation example', 2, None, 'an-extrapolation-example'),
              ('Formatting the Data', 2, None, 'formatting-the-data'),
              ('Predicting New Points With A Trained Recurrent Neural Network',
               2,
               None,
               'predicting-new-points-with-a-trained-recurrent-neural-network'),
              ('Other Things to Try', 2, None, 'other-things-to-try'),
              ('Other Types of Recurrent Neural Networks',
               2,
               None,
               'other-types-of-recurrent-neural-networks'),
              ('Generative Models', 2, None, 'generative-models'),
              ('Generative Adversarial Networks',
               2,
               None,
               'generative-adversarial-networks'),
              ('Discriminator', 2, None, 'discriminator'),
              ('Learning Process', 2, None, 'learning-process'),
              ('More about the Learning Process',
               2,
               None,
               'more-about-the-learning-process'),
              ('Additional References', 2, None, 'additional-references'),
              ('Writing Our First Generative Adversarial Network',
               2,
               None,
               'writing-our-first-generative-adversarial-network'),
              ('MNIST and GANs', 2, None, 'mnist-and-gans'),
              ('Other Models', 2, None, 'other-models'),
              ('Training Step', 2, None, 'training-step'),
              ('Checkpoints', 2, None, 'checkpoints'),
              ('Exploring the Latent Space',
               2,
               None,
               'exploring-the-latent-space'),
              ('Getting Results', 2, None, 'getting-results'),
              ('Interpolating Between MNIST Digits',
               2,
               None,
               'interpolating-between-mnist-digits')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="week43-bs.html">Week 43: Deep Learning: Recurrent Neural Networks and other methods</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._week43-bs001.html#plans-for-week-43" style="font-size: 80%;">Plans for week 43</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs002.html#reading-recommendations" style="font-size: 80%;">Reading Recommendations</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs003.html#summary-on-deep-learning-methods" style="font-size: 80%;">Summary on Deep Learning Methods</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs004.html#cnns-in-brief" style="font-size: 80%;">CNNs in brief</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs005.html#recurrent-neural-networks-overarching-view" style="font-size: 80%;">Recurrent neural networks: Overarching view</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs006.html#set-up-of-an-rnn" style="font-size: 80%;">Set up of an RNN</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs007.html#a-simple-example" style="font-size: 80%;">A simple example</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs008.html#an-extrapolation-example" style="font-size: 80%;">An extrapolation example</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs009.html#formatting-the-data" style="font-size: 80%;">Formatting the Data</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs010.html#predicting-new-points-with-a-trained-recurrent-neural-network" style="font-size: 80%;">Predicting New Points With A Trained Recurrent Neural Network</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs011.html#other-things-to-try" style="font-size: 80%;">Other Things to Try</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs012.html#other-types-of-recurrent-neural-networks" style="font-size: 80%;">Other Types of Recurrent Neural Networks</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs013.html#generative-models" style="font-size: 80%;">Generative Models</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs014.html#generative-adversarial-networks" style="font-size: 80%;">Generative Adversarial Networks</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs015.html#discriminator" style="font-size: 80%;">Discriminator</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs016.html#learning-process" style="font-size: 80%;">Learning Process</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs017.html#more-about-the-learning-process" style="font-size: 80%;">More about the Learning Process</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs018.html#additional-references" style="font-size: 80%;">Additional References</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs019.html#writing-our-first-generative-adversarial-network" style="font-size: 80%;">Writing Our First Generative Adversarial Network</a></li>
     <!-- navigation toc: --> <li><a href="#mnist-and-gans" style="font-size: 80%;">MNIST and GANs</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs021.html#other-models" style="font-size: 80%;">Other Models</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs022.html#training-step" style="font-size: 80%;">Training Step</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs023.html#checkpoints" style="font-size: 80%;">Checkpoints</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs024.html#exploring-the-latent-space" style="font-size: 80%;">Exploring the Latent Space</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs025.html#getting-results" style="font-size: 80%;">Getting Results</a></li>
     <!-- navigation toc: --> <li><a href="._week43-bs026.html#interpolating-between-mnist-digits" style="font-size: 80%;">Interpolating Between MNIST Digits</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0020"></a>
<!-- !split -->

<h2 id="mnist-and-gans" class="anchor">MNIST and GANs </h2>

<p>
Let's have a quick look

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span>plt<span style="color: #666666">.</span>imshow(train_images[<span style="color: #666666">0</span>], cmap<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Greys&#39;</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
Now we define our two models. This is where the 'magic' happens. There are a
huge amount of possible formulations for both models. A lot of engineering and
trial and error can be done here to try to produce better performing models. For
more advanced GANs this is by far the step where you can 'make or break' a
model.

<p>
We start with the generator. As stated in the introductory text the generator
\( g \) upsamples from a random sample to the shape of what we want to predict. In
our case we are trying to predict MNIST images (\( 28\times 28 \) pixels).

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">generator_model</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    The generator uses upsampling layers tf.keras.layers.Conv2DTranspose() to</span>
<span style="color: #BA2121; font-style: italic">    produce an image from a random seed. We start with a Dense layer taking this</span>
<span style="color: #BA2121; font-style: italic">    random sample as an input and subsequently upsample through multiple</span>
<span style="color: #BA2121; font-style: italic">    convolutional layers.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>

    <span style="color: #408080; font-style: italic"># we define our model</span>
    model <span style="color: #666666">=</span> tf<span style="color: #666666">.</span>keras<span style="color: #666666">.</span>Sequential()


    <span style="color: #408080; font-style: italic"># adding our input layer. Dense means that every neuron is connected and</span>
    <span style="color: #408080; font-style: italic"># the input shape is the shape of our random noise. The units need to match</span>
    <span style="color: #408080; font-style: italic"># in some sense the upsampling strides to reach our desired output shape.</span>
    <span style="color: #408080; font-style: italic"># we are using 100 random numbers as our seed</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Dense(units<span style="color: #666666">=7*7*</span>BATCH_SIZE,
                           use_bias<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>,
                           input_shape<span style="color: #666666">=</span>(<span style="color: #666666">100</span>, )))
    <span style="color: #408080; font-style: italic"># we normalize the output form the Dense layer</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>BatchNormalization())
    <span style="color: #408080; font-style: italic"># and add an activation function to our &#39;layer&#39;. LeakyReLU avoids vanishing</span>
    <span style="color: #408080; font-style: italic"># gradient problem</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>LeakyReLU())
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Reshape((<span style="color: #666666">7</span>, <span style="color: #666666">7</span>, BATCH_SIZE)))
    <span style="color: #008000; font-weight: bold">assert</span> model<span style="color: #666666">.</span>output_shape <span style="color: #666666">==</span> (<span style="color: #008000; font-weight: bold">None</span>, <span style="color: #666666">7</span>, <span style="color: #666666">7</span>, BATCH_SIZE)
    <span style="color: #408080; font-style: italic"># even though we just added four keras layers we think of everything above</span>
    <span style="color: #408080; font-style: italic"># as &#39;one&#39; layer</span>

    <span style="color: #408080; font-style: italic"># next we add our upscaling convolutional layers</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Conv2DTranspose(filters<span style="color: #666666">=128</span>,
                                     kernel_size<span style="color: #666666">=</span>(<span style="color: #666666">5</span>, <span style="color: #666666">5</span>),
                                     strides<span style="color: #666666">=</span>(<span style="color: #666666">1</span>, <span style="color: #666666">1</span>),
                                     padding<span style="color: #666666">=</span><span style="color: #BA2121">&#39;same&#39;</span>,
                                     use_bias<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>))
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>BatchNormalization())
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>LeakyReLU())
    <span style="color: #008000; font-weight: bold">assert</span> model<span style="color: #666666">.</span>output_shape <span style="color: #666666">==</span> (<span style="color: #008000; font-weight: bold">None</span>, <span style="color: #666666">7</span>, <span style="color: #666666">7</span>, <span style="color: #666666">128</span>)

    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Conv2DTranspose(filters<span style="color: #666666">=64</span>,
                                     kernel_size<span style="color: #666666">=</span>(<span style="color: #666666">5</span>, <span style="color: #666666">5</span>),
                                     strides<span style="color: #666666">=</span>(<span style="color: #666666">2</span>, <span style="color: #666666">2</span>),
                                     padding<span style="color: #666666">=</span><span style="color: #BA2121">&#39;same&#39;</span>,
                                     use_bias<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>))
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>BatchNormalization())
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>LeakyReLU())
    <span style="color: #008000; font-weight: bold">assert</span> model<span style="color: #666666">.</span>output_shape <span style="color: #666666">==</span> (<span style="color: #008000; font-weight: bold">None</span>, <span style="color: #666666">14</span>, <span style="color: #666666">14</span>, <span style="color: #666666">64</span>)

    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Conv2DTranspose(filters<span style="color: #666666">=1</span>,
                                     kernel_size<span style="color: #666666">=</span>(<span style="color: #666666">5</span>, <span style="color: #666666">5</span>),
                                     strides<span style="color: #666666">=</span>(<span style="color: #666666">2</span>, <span style="color: #666666">2</span>),
                                     padding<span style="color: #666666">=</span><span style="color: #BA2121">&#39;same&#39;</span>,
                                     use_bias<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>,
                                     activation<span style="color: #666666">=</span><span style="color: #BA2121">&#39;tanh&#39;</span>))
    <span style="color: #008000; font-weight: bold">assert</span> model<span style="color: #666666">.</span>output_shape <span style="color: #666666">==</span> (<span style="color: #008000; font-weight: bold">None</span>, <span style="color: #666666">28</span>, <span style="color: #666666">28</span>, <span style="color: #666666">1</span>)

    <span style="color: #008000; font-weight: bold">return</span> model
</pre></div>
<p>
And there we have our 'simple' generator model. Now we move on to defining our
discriminator model \( d \), which is a convolutional neural network based image
classifier.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">discriminator_model</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    The discriminator is a convolutional neural network based image classifier</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>

    <span style="color: #408080; font-style: italic"># we define our model</span>
    model <span style="color: #666666">=</span> tf<span style="color: #666666">.</span>keras<span style="color: #666666">.</span>Sequential()
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Conv2D(filters<span style="color: #666666">=64</span>,
                            kernel_size<span style="color: #666666">=</span>(<span style="color: #666666">5</span>, <span style="color: #666666">5</span>),
                            strides<span style="color: #666666">=</span>(<span style="color: #666666">2</span>, <span style="color: #666666">2</span>),
                            padding<span style="color: #666666">=</span><span style="color: #BA2121">&#39;same&#39;</span>,
                            input_shape<span style="color: #666666">=</span>[<span style="color: #666666">28</span>, <span style="color: #666666">28</span>, <span style="color: #666666">1</span>]))
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>LeakyReLU())
    <span style="color: #408080; font-style: italic"># adding a dropout layer as you do in conv-nets</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Dropout(<span style="color: #666666">0.3</span>))


    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Conv2D(filters<span style="color: #666666">=128</span>,
                            kernel_size<span style="color: #666666">=</span>(<span style="color: #666666">5</span>, <span style="color: #666666">5</span>),
                            strides<span style="color: #666666">=</span>(<span style="color: #666666">2</span>, <span style="color: #666666">2</span>),
                            padding<span style="color: #666666">=</span><span style="color: #BA2121">&#39;same&#39;</span>))
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>LeakyReLU())
    <span style="color: #408080; font-style: italic"># adding a dropout layer as you do in conv-nets</span>
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Dropout(<span style="color: #666666">0.3</span>))

    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Flatten())
    model<span style="color: #666666">.</span>add(layers<span style="color: #666666">.</span>Dense(<span style="color: #666666">1</span>))

    <span style="color: #008000; font-weight: bold">return</span> model
</pre></div>
<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._week43-bs019.html">&laquo;</a></li>
  <li><a href="._week43-bs000.html">1</a></li>
  <li><a href="">...</a></li>
  <li><a href="._week43-bs012.html">13</a></li>
  <li><a href="._week43-bs013.html">14</a></li>
  <li><a href="._week43-bs014.html">15</a></li>
  <li><a href="._week43-bs015.html">16</a></li>
  <li><a href="._week43-bs016.html">17</a></li>
  <li><a href="._week43-bs017.html">18</a></li>
  <li><a href="._week43-bs018.html">19</a></li>
  <li><a href="._week43-bs019.html">20</a></li>
  <li class="active"><a href="._week43-bs020.html">21</a></li>
  <li><a href="._week43-bs021.html">22</a></li>
  <li><a href="._week43-bs022.html">23</a></li>
  <li><a href="._week43-bs023.html">24</a></li>
  <li><a href="._week43-bs024.html">25</a></li>
  <li><a href="._week43-bs025.html">26</a></li>
  <li><a href="._week43-bs026.html">27</a></li>
  <li><a href="._week43-bs021.html">&raquo;</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="https://..."><img width="250" align=right src="https://..."></a>
</footer>
-->


<center style="font-size:80%">
<!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

